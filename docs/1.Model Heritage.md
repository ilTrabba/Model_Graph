# Model Heritage - MVP

A Model Lake system for the automatic versioning of Machine Learning models based on weight analysis, with a web interface for browsing and adding models.

## 🎯 Objective

Model Heritage automatically identifies parent-child relationships between ML models by analyzing only their weights, without relying on metadata or naming conventions. The system groups models into structurally similar families and reconstructs their genealogy using the MoTHer algorithm.

## 🏗️ MVP Architecture

### Backend (Flask)
- **REST API** for model upload, listing, and details
- **SQLite database** with Model and Family tables
- **Stub algorithm** for automatic versioning:
  - Extract architectural signature from weights
  - Cluster into families by structural similarity
  - Search for parent-child within a family
- **CORS** enabled for frontend integration

### Frontend (React)
- **Navbar** with "Model Heritage", "Models", and "Add Model"
- **Homepage** with system description and features
- **Model catalog** with alphabetical search and filters
- **Upload form** accessible via the navbar
- **Model detail** with lineage and metadata
- **Responsive design** with Tailwind CSS and shadcn/ui

## 🚀 Quick Start

### Prerequisites
- Python 3.11+
- Node.js 20+
- pnpm

### Backend
```bash
cd model_heritage_backend
source venv/bin/activate
python run_server.py
```
The backend will be available at `http://localhost:5001`

### Frontend
```bash
cd model_heritage_frontend
pnpm run dev --host
```
The frontend will be available at `http://localhost:5173`

## 📁 Project Structure

```
model_heritage_backend/
├── src/
│   ├── models/
│   │   ├── user.py          # Base database
│   │   └── model.py         # Model and Family models
│   ├── routes/
│   │   ├── user.py          # User routes (template)
│   │   └── models.py        # Model APIs
│   ├── main.py              # Main Flask app
│   └── database/            # SQLite database
├── uploads/                 # Uploaded model files
├── venv/                    # Virtual environment
└── run_server.py            # Server startup script

model_heritage_frontend/
├── src/
│   ├── components/
│   │   ├── ui/              # shadcn/ui components
│   │   └── Navbar.jsx       # Navigation bar
│   ├── pages/
│   │   ├── HomePage.jsx     # Homepage
│   │   ├── ModelsPage.jsx   # Model catalog
│   │   ├── ModelDetailPage.jsx # Model detail
│   │   └── AddModelPage.jsx # Upload form
│   └── App.jsx              # Main app
└── package.json
```

## 🔌 API Endpoints

### Models
- `GET /api/models` - List all models with optional search
- `GET /api/models/{id}` - Model detail with lineage
- `POST /api/models` - Upload a new model
- `GET /api/families` - List model families
- `GET /api/families/{id}/models` - Models in a family
- `GET /api/stats` - System statistics

### Upload Example
```bash
curl -X POST http://localhost:5001/api/models \
  -F "file=@model.pt" \
  -F "name=My Model" \
  -F "description=Test model"
```

## 🧬 Versioning Algorithm (Stub)

### 1. Signature Extraction
```python
def extract_weight_signature_stub(file_path):
    # Analyze file size to estimate parameters
    # Compute structural hash
    # Extract estimated layer count
    return signature
```

### 2. Family Assignment
```python
def assign_to_family_stub(signature):
    # Group by parameter ranges:
    # - small_models: < 1M parameters
    # - medium_models: 1M–100M parameters
    # - large_models: > 100M parameters
    return family_id
```

### 3. Parent Search
```python
def find_parent_stub(model, family_id):
    # Find the most similar model by parameter count
    # Compute confidence based on similarity
    return parent_id, confidence
```

## 🎨 User Interface

### Navbar
- **Logo and title**: "Model Heritage" with a database icon
- **Models section**: Link to the model catalog
- **Add Model button**: Direct access to the upload form

### Model Catalog
- **Search**: Case-insensitive search bar by name
- **Compact cards**: Name, parameters, layers, family, status
- **Sorting**: Alphabetical by name
- **Empty state**: Message and link for the first upload

### Upload Form
- **File picker**: Drag & drop for .safetensors, .pt, .bin, .pth
- **Metadata**: Name (required) and description (optional)
- **Validation**: Format and size checks
- **Feedback**: Progress and error/success messages

### Model Detail
- **Specifications**: Parameters, layers, structural hash
- **Lineage**: Parent and children with confidence score
- **Family**: Badge and group information
- **Timeline**: Creation and processing dates

## 🔧 Configuration

### Backend
- **Port**: 5001 (avoids conflicts with other services)
- **Database**: SQLite at `src/database/app.db`
- **Upload**: `uploads/` directory with checksum verification
- **CORS**: Enabled for all domains

### Frontend
- **Port**: 5173 (Vite default)
- **API URL**: Hardcoded `http://localhost:5001`
- **Routing**: React Router for SPA
- **Styling**: Tailwind CSS + shadcn/ui

## 🧪 Functional Tests

### Upload Test
1. Go to `http://localhost:5173`
2. Click "Add Model" in the navbar
3. Upload a test .pt file
4. Fill in name and description
5. Verify upload and processing

### Catalog Test
1. Go to "Models" in the navbar
2. Verify model display
3. Test search by name
4. Click a model for details

### API Test
```bash
# List models
curl http://localhost:5001/api/models

# Statistics
curl http://localhost:5001/api/stats

# Upload test
curl -X POST http://localhost:5001/api/models \
  -F "file=@test_model.pt" \
  -F "name=Test Model"
```

## 🚧 Next Steps

### Real MoTHer Integration
- Replace the stub with the full MoTHer algorithm
- Implement PyTorch/SafeTensors weight analysis
- Add 4-step clustering with centroids
- Integrate minimum spanning arborescence

### Scalability
- Migrate from SQLite to PostgreSQL
- Add Redis for caching
- Implement a job queue with RQ/Celery
- Containerize with Docker Compose

### Advanced UIs
- Family graph visualization with vis-network
- Statistics dashboard with Recharts
- Advanced filters (family, parameters, date)
- Export lineage to standard formats

### Production
- Authentication and authorization
- Rate limiting and robust validation
- Monitoring and structured logging
- Automatic database backups

## 📝 Technical Notes

### MVP Limitations
- **Simplified algorithm**: Stub based on file size
- **Local storage**: Files and database are not distributed
- **Minimal security**: No authentication
- **Limited scalability**: Single-threaded processing

### Supported Formats
- **.safetensors**: Preferred format (safe)
- **.pt/.pth**: Standard PyTorch
- **.bin**: Binary pickle (legacy)

### Performance
- **Upload**: Limited to files < 5GB (configurable)
- **Processing**: Synchronous for MVP (asynchronous in production)
- **Database**: SQLite suitable for < 1000 models

## 🤝 Contributions

To extend the system:

1. **Backend**: Add endpoints in `src/routes/models.py`
2. **Frontend**: Create components in `src/components/`
3. **Database**: Modify models in `src/models/model.py`
4. **Algorithms**: Implement in separate modules

### Conventions
- **API**: REST with JSON responses
- **Frontend**: Functional components with hooks
- **Styling**: Tailwind classes, avoid custom CSS
- **Database**: SQLAlchemy ORM with migrations

## 📄 License

Project developed for educational and research purposes.